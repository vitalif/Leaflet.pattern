/*
 Leaflet.pattern, Provides tools to set the backgrounds of vector shapes in Leaflet to be patterns.
 https://github.com/teastman/Leaflet.pattern
 (c) 2015, Tyler Eastman
*/
!function(t){if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)module.exports=t(require("leaflet"));else{if("undefined"==typeof window.L)throw new Error("Leaflet must be loaded first");t(window.L)}}(function(t){t.Pattern=t.Class.extend({includes:[t.Evented],options:{x:0,y:0,width:8,height:8,patternUnits:"userSpaceOnUse",patternContentUnits:"userSpaceOnUse"},_addShapes:t.Util.falseFn,_update:t.Util.falseFn,initialize:function(e){this._shapes={},t.setOptions(this,e)},onAdd:function(t){this._map=t.target?t.target:t,this._map._initDefRoot(),this._initDom();for(var e in this._shapes)this._shapes[e].onAdd(this);this._addShapes(),this._addDom(),this.redraw(),this.getEvents&&this._map.on(this.getEvents(),this),this._map.fire("add"),this._map.fire("patternadd",{pattern:this})},onRemove:function(){this._removeDom()},redraw:function(){if(this._map){this._update();for(var t in this._shapes)this._shapes[t].redraw()}return this},setStyle:function(e){return t.setOptions(this,e),this._map&&(this._updateStyle(),this.redraw()),this},addTo:function(t){return t.addPattern(this),this},remove:function(){return this.removeFrom(this._map)},removeFrom:function(t){return t&&t.removePattern(this),this}}),t.Map.addInitHook(function(){this._patterns={}}),t.Map.include({addPattern:function(e){var i=t.stamp(e);return this._patterns[i]?e:(this._patterns[i]=e,this.whenReady(e.onAdd,e),this)},removePattern:function(e){var i=t.stamp(e);return this._patterns[i]?(this._loaded&&e.onRemove(this),e.getEvents&&this.off(e.getEvents(),e),delete this._patterns[i],this._loaded&&(this.fire("patternremove",{pattern:e}),e.fire("remove")),e._map=null,this):this},hasPattern:function(e){return!!e&&t.stamp(e)in this._patterns}}),t.Pattern.SVG_NS="http://www.w3.org/2000/svg",t.Pattern=t.Pattern.extend({_createElement:function(e){return document.createElementNS(t.Pattern.SVG_NS,e)},_initDom:function(){this._dom=this._createElement("pattern"),this.options.className&&t.DomUtil.addClass(this._dom,this.options.className),this._updateStyle()},_addDom:function(){this._map._defRoot.appendChild(this._dom)},_removeDom:function(){t.DomUtil.remove(this._dom)},_updateStyle:function(){var e=this._dom,i=this.options;if(e){if(e.setAttribute("id",i.id||t.stamp(this)),e.setAttribute("x",i.x),e.setAttribute("y",i.y),e.setAttribute("width",i.width),e.setAttribute("height",i.height),e.setAttribute("patternUnits",i.patternUnits),e.setAttribute("patternContentUnits",i.patternContentUnits),i.patternTransform||i.angle){var s=i.patternTransform?i.patternTransform+" ":"";s+=i.angle?"rotate("+i.angle+") ":"",e.setAttribute("patternTransform",s)}else e.removeAttribute("patternTransform");for(var n in this._shapes)this._shapes[n]._updateStyle()}}}),t.Map.include({_initDefRoot:function(){if(!this._defRoot)if("function"==typeof this.getRenderer){var e=this.getRenderer(this);this._defRoot=t.Pattern.prototype._createElement("defs"),e._container.appendChild(this._defRoot)}else this._pathRoot||this._initPathRoot(),this._defRoot=t.Pattern.prototype._createElement("defs"),this._pathRoot.appendChild(this._defRoot)}}),t.SVG?t.SVG.include({_superUpdateStyle:t.SVG.prototype._updateStyle,_updateStyle:function(e){this._superUpdateStyle(e),e.options.fill&&e.options.fillPattern&&(e.options.fillPattern.addTo(this._map),e._path.setAttribute("fill","url(#"+t.stamp(e.options.fillPattern)+")"))}}):t.Path.include({_superUpdateStyle:t.Path.prototype._updateStyle,_updateStyle:function(){this._superUpdateStyle(),this.options.fill&&this.options.fillPattern&&(this.options.fillPattern.addTo(this._map),this._path.setAttribute("fill","url(#"+t.stamp(this.options.fillPattern)+")"))}}),t.StripePattern=t.Pattern.extend({options:{weight:4,spaceWeight:4,color:"#000000",spaceColor:"#ffffff",opacity:1,spaceOpacity:0},_addShapes:function(){this._stripe=new t.PatternPath({stroke:!0,weight:this.options.weight,color:this.options.color,opacity:this.options.opacity}),this._space=new t.PatternPath({stroke:!0,weight:this.options.spaceWeight,color:this.options.spaceColor,opacity:this.options.spaceOpacity}),this.addShape(this._stripe),this.addShape(this._space),this._update()},_update:function(){this._stripe.options.d="M0 "+this._stripe.options.weight/2+" H "+this.options.width,this._space.options.d="M0 "+(this._stripe.options.weight+this._space.options.weight/2)+" H "+this.options.width},setStyle:t.Pattern.prototype.setStyle}),t.stripePattern=function(e){return new t.StripePattern(e)},t.PatternShape=t.Class.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",fillOpacity:.2,fillRule:"evenodd"},initialize:function(e){t.setOptions(this,e)},onAdd:function(t){this._pattern=t,this._pattern._dom&&(this._initDom(),this._addDom())},addTo:function(t){return t.addShape(this),this},redraw:function(){return this._pattern&&this._updateShape(),this},setStyle:function(e){return t.setOptions(this,e),this._pattern&&this._updateStyle(),this},setShape:function(e){this.options=t.extend({},this.options,e),this._updateShape()}}),t.Pattern.include({addShape:function(e){var i=t.stamp(e);return this._shapes[i]?e:(this._shapes[i]=e,e.onAdd(this),void 0)}}),t.PatternShape.SVG_NS="http://www.w3.org/2000/svg",t.PatternShape=t.PatternShape.extend({_createElement:function(e){return document.createElementNS(t.PatternShape.SVG_NS,e)},_initDom:t.Util.falseFn,_updateShape:t.Util.falseFn,_initDomElement:function(e){this._dom=this._createElement(e),this.options.className&&t.DomUtil.addClass(this._dom,this.options.className),this._updateStyle()},_addDom:function(){this._pattern._dom.appendChild(this._dom)},_updateStyle:function(){var e=this._dom,i=this.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(i.fillPattern?e.setAttribute("fill","url(#"+t.stamp(i.fillPattern)+")"):e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"),e.setAttribute("pointer-events",i.pointerEvents||(i.interactive?"visiblePainted":"none")))}}),t.PatternPath=t.PatternShape.extend({_initDom:function(){this._initDomElement("path")},_updateShape:function(){this._dom&&this._dom.setAttribute("d",this.options.d)}}),t.PatternCircle=t.PatternShape.extend({options:{x:0,y:0,radius:0},_initDom:function(){this._initDomElement("circle")},_updateShape:function(){this._dom&&(this._dom.setAttribute("cx",this.options.x),this._dom.setAttribute("cy",this.options.y),this._dom.setAttribute("r",this.options.radius))}}),t.PatternRect=t.PatternShape.extend({options:{x:0,y:0,width:10,height:10},_initDom:function(){this._initDomElement("rect")},_updateShape:function(){this._dom&&(this._dom.setAttribute("x",this.options.x),this._dom.setAttribute("y",this.options.y),this._dom.setAttribute("width",this.options.width),this._dom.setAttribute("height",this.options.height),this.options.rx&&this._dom.setAttribute("rx",this.options.rx),this.options.ry&&this._dom.setAttribute("ry",this.options.ry))}})});